<!DOCTYPE html>
<html lang="ja">

<head prefix="og: https://ogp.me/ns#">

    <meta name="local-env">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--general-->
    <link rel="stylesheet" href="../../general/css/common.css">
    <script src="../../general/js/common.js" type="module"></script>
    <link rel="shortcut icon" href="/monologue/favicon.ico" type="image/x-icon">

    <!--OGP-->
    <meta property="og:site_name" content="Monologue">
    <meta property="og:url" content="https://oignonasappy.github.io/monologue/pages/[FOLDER NAME IS HERE]/index.html">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ja_JP">

    <!--Prism.js-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-core.min.js" defer></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/autoloader/prism-autoloader.min.js" defer></script>
    <!--Prism.js plugins-->
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/normalize-whitespace/prism-normalize-whitespace.min.js" defer></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.js" defer></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.css">

    <title>あなたのページに鍵盤を表示する[Piano.js]</title>
    <meta property="og:title" content="あなたのページに鍵盤を表示する[Piano.js]">
    <meta name="description" content="Lorem, ipsum.">
    <meta property="og:description" content="サイト上でピアノが弾けます！">

    <link rel="stylesheet" href="./style.css">
    <script src="./piano.js" defer></script>
</head>

<body>
    <div id="container">
        <main>
            <h1>Piano.js</h1>
            <h3>プレビュー</h3>
            <div class="piano" data-first="60" data-last="84" data-key-width="20px" data-key-height="60px"
                data-highlight="72 75 79" data-highlight-color="#FFE0E0" data-notename="true" data-key-signature="F dor"></div>
            <div class="piano" data-first="57" data-last="81" data-key-width="30px" data-key-height="70px" data-custom-notename="65 Gbb, 69 Gx"></div>
            <div class="piano-hover" data-first="48" data-last="60" data-highlight="52 54" data-highlight-color="#E0FFFF"></div>
            <div class="piano-play" data-first="36" data-last="67" data-key-width="30px" data-key-height="90px" data-highlight="52 54" data-highlight-color="#E0FFFF"></div>
            <div id="piano1" class="piano" data-first="48" data-last="72" data-key-width="30px" data-key-height="120px" data-highlight="48 51 55 58 62 65 69" data-highlight-color="#FFFF00" data-notename="true" data-key-signature="C dor"></div>
            <button onclick="playHighlighted('piano1')">PLAY CHORD</button>
            <button onclick="playNote(60, 0.3, 3, 'square')">PLAY NOTE</button>
            <button onclick="playNoteAll([0,7,14,21,28,35,42,49,56,63,70,77,84,91,98], 0.2, 3, 'sawtooth')">playNoteAll()</button>
            <button onclick="playNoteAll([60,60.2])">aaa</button>
            <div id="piano2" class="piano-hover" data-first="24" data-last="96" data-key-width="14px" data-key-height="60px" data-notename="true" data-key-signature="C mix" data-volume="0.1" data-duration="4" data-osc-type="sawtooth" data-tuning="440"></div>
            <button onclick="playKeys('piano2', [24, 28, 31, 34, 38, 42, 45, 48, 52, 56, 59, 62, 66, 70, 73, 76, 80, 84, 87, 90, 94])">playKeys()</button>
            <h2>つかいかた</h2>
                <h3>呼び出し</h3>
                <ol>
                    <li>
                        <h4>JavaScriptの読み込み</h4>
                        <p>Lorem, ipsum.</p>
                    </li>
                    <li>
                        <h4>&lt;div&gt;の配置</h4>
                        <p>記述例：</p>
                        <ul>
                            <li><code class="lang-html">&lt;div class="piano"&gt;&lt;/div&gt;</code></li>
                            <li><code class="lang-html">&lt;div&gt;&lt;/div&gt;</code></li>
                        </ul>

                        <h3>種類</h3>
                        <ul>
                            <li>
                                <h4>.piano</h4>
                            </li>
                            <li>
                                <h4>.piano-hover</h4>
                            </li>
                            <li>
                                <h4>.piano-play</h4>
                            </li>
                        </ul>
                        <h3>データ属性</h3>
                        <p><code class="lang-html">data-*=""</code></p>
                        <ul>
                            <li>
                                <h4>data-first, data-last</h4>
                                <p>
                                    <span class="code">data-first: &lt;integer&gt; = 0 &lt;= x</span><br>
                                    <span class="code">data-last: &lt;integer&gt; = data-first &lt;= x</span><br>
                                    記述例 : <code class="lang-html"></code><br>
                                    data-first既定 : <span class="code">60</span><br>
                                    data-last既定 : <span class="code">data-first+12</span>
                                </p>
                            </li>
                            <li>
                                <h4>data-key-width, data-key-width</h4>
                                <p>
                                    <span class="code">data-key-width: &lt;length&gt; = 0 &lt; x</span><br>
                                    <span class="code">data-key-height: &lt;length&gt; = 0 &lt; x</span><br>
                                    記述例 : <code class="lang-html"></code><br>
                                    data-key-width既定 : <span class="code">20px</span><br>
                                    data-key-width既定 : <span class="code">60px</span>
                                </p>
                            </li>
                            <li>
                                <h4>data-highlight</h4>
                                <p>
                                    <span class="code">data-highlight: &lt;integer[*]&gt; = [data-first &lt;= x &lt;= data-last]*</span><br>
                                    記述例 : <code class="lang-html"></code><br>
                                    既定 : <span class="code"><i>なし</i></span>
                                </p>
                            </li>
                            <li>
                                <h4>data-highlight-color</h4>
                                <p>
                                    <span class="code">data-highlight-color: &lt;color&gt; = x</span><br>
                                    記述例 : <code class="lang-html"></code><br>
                                    既定 : <span class="code">#FFE0E0</span>
                                </p>
                                <p>
                                    ※このデータ属性は<span class="code">data-highlight</span>が設定されているときのみ機能します。<br>
                                </p>
                            </li>
                            <li>
                                <h4>data-notename</h4>
                                <p>
                                    <span class="code">data-notename: &lt;boolean&gt; = "true" | "false"</span><br>
                                    記述例 : <code class="lang-html"></code><br>
                                    既定 : <span class="code">false</span>
                                </p>
                            </li>
                            <li>
                                <h4>data-key-signature</h4>
                                <p>
                                    <span class="code">data-key-signature: &lt;string[2]&gt; = (C ~ B) (lyd ~ loc)</span><br>
                                    記述例 : <code class="lang-html">data-key-signature="F Phr"</code><br>
                                    既定 : <span class="code">C Maj</span>
                                </p>
                                <p>
                                    ※このデータ属性は<span class="code">data-notename="true"</span>のときのみ機能します。<br>
                                    音名・モードを半角スペースで区切ります。大文字、小文字の区別はありません。<br>
                                    音名には臨時記号を含めることができます。シャープは'#'で表し、フラットは'b'で表します。ここに含まれない臨時記号は使用することができません。<br>
                                    モード(教会旋法)はモード名の頭三文字の表記<span class="no-wrap">[Lyd, Ion(Maj), Mix, Dor, Aeo(Min), Phr, Loc]</span>の中から選択します。ここに含まれないスケールは<span class="code">data-custom-notename</span>から手動で設定してください。<br>
                                    調号が6個つく「bと#が切り替わる地点(例えば、変ト長調と嬰ヘ長調)」の場合bが6個の表記を採用します。(つまり、BはCbとして表記します。)
                                </p>
                            </li>
                            <li>
                                <h4>data-custom-notename</h4>
                                <p>
                                    <span class="code">data-: &lt;integer, string&gt;[*] = [(data-first &lt;= x &lt;= data-last) (string)]*</span><br>
                                    記述例 : <code class="lang-html"></code><br>
                                    既定 : <span class="code"><i>なし</i></span>
                                </p>
                            </li>
                            <li>
                                <h4>data-volume ※再生用</h4>
                                <p>
                                    <span class="code">data-volume: &lt;number&gt; = 0.0 &lt; x (&lt;= 1.0)</span><br>
                                    記述例 : <code class="lang-html">data-volume="0.25"</code><br>
                                    既定 : <span class="code">0.25</span>
                                </p>
                                <p>
                                    振幅。<br>
                                    入力は対数スケールに変換され、線形な音量変化になる。<br>
                                    <b>とても音が大きい場合があります！</b>必ず小さい音量からお試しください。耳を痛めないように
                                </p>
                            </li>
                            <li>
                                <h4>data-duration ※再生用</h4>
                                <p>
                                    <span class="code">data-duration: &lt;number&gt; = 0.0 &lt; x</span><br>
                                    記述例 : <code class="lang-html"></code><br>
                                    既定 : <span class="code">2</span>
                                </p>
                            </li>
                            <li>
                                <h4>data-osc-type ※再生用</h4>
                                <p>
                                    <span class="code">data-osc-type: &lt;string&gt; = sine | triangle | square | sawtooth</span><br>
                                    記述例 : <code class="lang-html"></code><br>
                                    既定 : <span class="code">triangle</span>
                                </p>
                                <p>
                                    詳しくは<span class="code">OscillatorNode</span>の<a href="https://developer.mozilla.org/ja/docs/Web/API/OscillatorNode/type">ドキュメント</a>を参照
                                </p>
                            </li>
                            <li>
                                <h4>data-tuning ※再生用</h4>
                                <p>
                                    <span class="code">data-tuning: &lt;number&gt; = 0.0 &lt; x</span><br>
                                    記述例 : <code class="lang-html"></code><br>
                                    既定 : <span class="code">440</span>
                                </p>
                                私得である。
                            </li>
                        </ul>
                    </li>
                </ol>
                <h3>メソッド</h3>
                <ol>
                    <li>
                        <h4>playNote()</h4>
                        引数
                        <ol>
                            <li>
                                midi<br>
                                実は小数も指定することができる。これにより微分音を再生することができる。
                            </li>
                            <li>
                                volume
                            </li>
                            <li>
                                duration
                            </li>
                            <li>
                                tuning
                            </li>
                        </ol>
                        <p>
                            デフォルトを呼び出す際は引数に<code class="lang-js">undefined</code>を設定する
                            今後オブジェクト引数に書き直すかも
                        </p>
                    </li>
                    <li>
                        <h4>playNoteAll()</h4>
                    </li>
                    <li>
                        <h4>playKeys()</h4>
                        ピアノに設定されているパラメータで音を鳴らします。<br>
                        これらの属性に設定されている値を使用します。
                        <ul>
                            <li>data-volume</li>
                            <li>data-duration</li>
                            <li>data-osc-type</li>
                            <li>data-tuning</li>
                        </ul>
                    </li>
                    <li>
                        <h4>playHighlighted()</h4>
                    </li>
                    <li>
                        <h4>sequencer()</h4>
                        引数
                        <ol>
                            <li>
                                call<br>
                                ラムダ推奨
                            </li>
                            <li>
                                sequence<br>
                                秒数
                            </li>
                            <li>
                                values<br>

                            </li>
                            <li>
                                bpm<br>

                            </li>
                        </ol>
                    </li>
                </ol>

            <h3>その他</h3>
            <p>
                ピアノ全体に対してスタイリングする時は、<wbr>
                <code class="lang-html">.piano-wrapper</code>に対して行うことを<wbr>推奨します。
                (このクラスはピアノ全体をラップしています)<br>
                <code class="lang-css">margin: auto</code>などを設定する際に適しています。
            </p>
            <h3>感想</h3>
            <p>
                要件定義は大事ですね。<br>
                今回、何もかも思いつきで機能を追加していったので、ソースコードにまとまりがなくなってしまってます。
            </p>
            <p>
                非効率だと分かっていながら、cssもhoverも何もかも一つのJavaScriptで実装しました。<br>
                なぜかと言えばこのpiano.jsを呼び出すとき、そのJavaScriptをただ一つだけ呼び出せばよくなるから。ホントにただそれだけです。
            </p>

            <pre style="height: 600px;"><code class="lang-js line-numbers" id="piano-js-src"></code></pre>
            <script>
                fetch('./piano.js')
                    .then(responce => responce.text())
                    .then(text => {
                        document.getElementById('piano-js-src').textContent = text;
                    })
                    .catch(e => {
                        document.getElementById('piano-js-src').textContent = "/* うまくよみこめんかった */";
                    });
            </script>

            <p>
                ソースコードがいささか汚いので、いつかリファクタリングするかも。きれいにすべき所が見つかります。
            </p>
        </main>
    </div>
</body>

</html>